(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/confirmation"],{"319d":function(t,e,i){"use strict";var o=i("f299"),s=i.n(o);s.a},"3a0d":function(t,e,i){"use strict";i.r(e);var o=i("46cf"),s=i.n(o);for(var n in o)"default"!==n&&function(t){i.d(e,t,function(){return o[t]})}(n);e["default"]=s.a},"46cf":function(t,e,i){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o={data:function(){return{word:[],id:"",secret:{},buylist:[],goodsPrice:0,payPrice:0,payLing:0,sumPrice:0,freight:5,note:"",int:1200,deduction:0,disType:null,disPrice:null,tips:"",minprice:0,recinfo:{},items:[],ship_name:"",shipmoney:"",choose:!1,store:"",ordersn:"",goods:[],goodsIdList:[],couponid:""}},onLoad:function(t){this.store=t.store,this.ordersn=t.ordersn,t.proid&&(this.goods=[t.proid,t.pronum]),this.goodsIdList=[t.goods_list],this.getAddress()},onShow:function(){var e=this;this.loadData(),t.getStorage({key:"selectAddress",success:function(t){console.log(t),e.recinfo=t.data}})},filters:{toFixed:function(t){return parseFloat(t).toFixed(2)}},methods:{getAddress:function(){var t=this;this.$xm.post("/Order/getDefAdr/","",function(e){console.log(e),t.recinfo=e})},loadData:function(){var e=this,i={store:this.store};this.ordersn?i.order_sn=this.ordersn:this.goods.length>0?i.goods=this.goods:this.goodsIdList&&(i.goods_list=this.goodsIdList),this.$xm.post("/cart/order",i,function(i){if(0==i.s)t.showToast({title:i.msg,icon:"none"});else{e.word=i.word,e.buylist=i.prolist,e.$xm.requestImg(e.buylist),e.minprice=Number(i.minprice),e.goodsPrice=i.allprice,e.tips=i.tips,e.payPrice=Number(i.allprice),e.minprice>e.payPrice&&(e.goodsPrice=e.payPrice+e.freight);var o=[];o=e.buylist.map(function(t){return t.proid+"/"+t.pronum}),e.discounts(o)}})},discounts:function(t){var e=this,i={store:this.store,goods_list:t};this.$xm.post("/Coupon/match_optimalss",i,function(t){if(t.data){2==t.data.type&&(e.couponid=t.data.id),e.sumPrice=t.data.money;var i=t.data.money;e.payLing=Number(i),e.minprice>e.payLing&&(e.sumPrice=e.payLing+e.freight),e.tips=t.data.msg,e.disPrice=t.data.cut,e.disType=t.data.type,e.getship()}})},getship:function(){var e=this;if(this.recinfo){var i={shipid:this.recinfo.id,allprice:this.payLing,store:this.store};this.$xm.post("/Order/getShipMoney",i,function(t){console.log(t),void 0!==t.data&&(t.data.constructor==Array?(e.items=t.data,e.items.forEach(function(t){t.checked=""}),e.items[0].checked=!0,e.ship_name=e.items[0].name,e.shipmoney=e.items[0].price,e.freight=e.items[0].price):(e.items=[],e.freight=t.data.price,e.shipmoney=t.data.price,e.ship_name=t.data.name))})}else t.showToast({title:"请选择收件地址！",icon:"none"})},shipChange:function(t){var e;this.ship_name=t.detail.value,"普通快递"==t.detail.value?(e=0,this.shipmoney=5):"顺丰快递"==t.detail.value?(e=1,this.shipmoney=15):t.detail.value.includes("包邮")&&(e=0,this.shipmoney=0),this.freight=this.items[e].price,this.goodsPrice=this.payPrice+this.freight,this.sumPrice=this.payLing+this.freight},toPay:function(){var e;if(e=t.getStorageSync("scene")?t.getStorageSync("scene"):"",this.recinfo){var o={shipid:this.recinfo.id,shipmoney:this.shipmoney,ship_name:this.ship_name,memo:this.note,couponid:this.couponid,store:this.store,scene:e};this.ordersn?o.order=this.ordersn:this.goods.length>0?o.goods=this.goods:this.goodsIdList&&(o.goods_list=this.goodsIdList),this.$xm.post("/Order/saveOrder",o,function(e){var o=e.data;1==e.s?t.requestPayment({timeStamp:o.timeStamp,nonceStr:o.nonceStr,package:o.package,signType:o.signType,paySign:o.paySign,success:function(t){console.log(t)},fail:function(t){console.log(t)},complete:function(e){"requestPayment:ok"==e.errMsg?t.showModal({title:"支付成功！",content:"",showCancel:!1,confirmText:"确  定",confirmColor:"#2c2c2c",success:function(e){t.redirectTo({url:"../user/order_list/order_list?tbIndex=1"})}}):t.showModal({title:"支付失败！",content:"",showCancel:!1,confirmText:"确  定",confirmColor:"#2c2c2c",success:function(t){t.confirm&&i.redirectTo({url:"../user/order_list/order_list?tbIndex=0"})}})}}):t.showToast({title:"地址不存在，请重新选择！",icon:"none"})})}else t.showToast({title:"请选择收件地址！",icon:"none"})},selectAddress:function(){t.navigateTo({url:"../user/address/address?type=select"})},togoods:function(e){console.log(e.proid),t.navigateTo({url:"../goods/goods?gid="+e.proid})}}};e.default=o}).call(this,i("f266")["default"],i("f266")["default"])},"664c":function(t,e,i){"use strict";(function(t){i("e146"),i("921b");o(i("66fd"));var e=o(i("fcc6"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("f266")["createPage"])},b23f:function(t,e,i){"use strict";var o,s=function(){var t=this,e=t.$createElement;t._self._c},n=[];i.d(e,"b",function(){return s}),i.d(e,"c",function(){return n}),i.d(e,"a",function(){return o})},f299:function(t,e,i){},fcc6:function(t,e,i){"use strict";i.r(e);var o=i("b23f"),s=i("3a0d");for(var n in s)"default"!==n&&function(t){i.d(e,t,function(){return s[t]})}(n);i("319d");var r,c=i("f0c5"),a=Object(c["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],r);e["default"]=a.exports}},[["664c","common/runtime","common/vendor"]]]);