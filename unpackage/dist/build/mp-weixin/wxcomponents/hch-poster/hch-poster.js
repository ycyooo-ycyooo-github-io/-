(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["wxcomponents/hch-poster/hch-poster"],{"0d80":function(e,t,o){"use strict";o.r(t);var n=o("1ea4"),s=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,function(){return n[e]})}(i);t["default"]=s.a},"1ea4":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o={data:function(){return{}},props:{canvasFlag:{type:Boolean,default:!0},posterObj:{type:null,default:{url:"",icon:"",title:"",discountPrice:"",orignPrice:"",code:""}}},methods:{roundRect:function(e,t,o,n,s,i,a,l,r){if(e.beginPath(),e.arc(t+i,o+i,i,Math.PI,1.5*Math.PI),e.moveTo(t+i,o),e.lineTo(t+n-i,o),e.arc(t+n-i,o+i,i,1.5*Math.PI,2*Math.PI),e.lineTo(t+n,o+s-i),e.arc(t+n-i,o+s-i,i,0,.5*Math.PI),e.arc(t+i,o+s-i,i,.5*Math.PI,Math.PI),e.lineTo(t,o+i),"btn"==r){var c=e.createLinearGradient(0,0,200,0);c.addColorStop(0,a),c.addColorStop(1,l),e.setFillStyle(c),e.fill()}else a&&(e.setFillStyle(a),e.fill()),l&&(e.setStrokeStyle(l),e.stroke());e.closePath(),e.clip()},canvasMultiLineText:function(e,t,o,n){for(var s=t.split(""),i="",a=[],l=0;l<s.length;l++)e.measureText(i).width<o?i+=s[l]:(l--,a.push(i),i="");if(a.push(i),a.length>n){console.log(a.length,n);var r=a.slice(0,n);console.log(a);var c=a[0];console.log(c);for(var h="",f=[],u=0;u<c.length;u++){if(!(e.measureText(h).width<o))break;h+=c[u]}f.push(h);var d=f[0]+"...";r.splice(n-1,1,d),a=r}return a},createCanvasImage:function(){var t=this;e.showLoading({title:"海报生成中..."});var o=this,n=e.getSystemInfoSync();this.phoneH=n.windowHeight,this.phoneW=n.windowWidth;this.phoneW;var s=this.phoneH/667,i=e.createCanvasContext("myCanvas"),a=this.posterObj.url;console.log(this.posterObj);this.posterObj.icon;var l,r,c=this.posterObj.code,h=this.posterObj.close;if(i.draw(),i.save(),this.roundRect(i,50,40,this.phoneW-100,this.phoneH-200,10,"#fff","#fff"),i.restore(),i.save(),this.roundRect(i,50,40,this.phoneW-100,340*s,10,"#f7f7f7","#f7f7f7"),i.restore(),a="https"+a.slice(4,a.length),e.getImageInfo({src:a,success:function(e){i.save(),console.log(e.path,1),o.posterObj.url=e.path,o.roundRect(i,(o.phoneW-(o.phoneW-130))/2,55,o.phoneW-130,250*s,10,"#f7f7f7","#f7f7f7"),i.drawImage(o.posterObj.url,(o.phoneW-(o.phoneW-130))/2,55,o.phoneW-130,250*s,10),i.restore(),i.draw(!0)},fail:function(e){console.log(e)}}),i.drawImage(h,o.phoneW-100+50+5,40,24,24),i.draw(!0),setTimeout(function(){i.setGlobalAlpha(1),i.setFillStyle("#1c1c1c"),i.setFontSize(14),i.font="normal bold 14px sans-serif";for(var e=t.posterObj.title,o=t.canvasMultiLineText(i,e,t.phoneW-130,1),n=350,a=65,l=18,r=0;r<o.length;r++)i.fillText(o[r],a,(n+l*r-15)*s,t.phoneW-130),i.draw(!0)},500),i.setFontSize(12),i.setFillStyle("#c00000"),i.font="normal 12px sans-serif",i.fillText("￥",60,360*s,60),i.setFontSize(16),console.log(this.posterObj.discountPrice),0==this.posterObj.discountPrice){l=this.posterObj.discountPrice,r=this.posterObj.orignPrice;var f=i.measureText(r).width;i.fillText(r,70,360*s,f)}else{r=this.posterObj.discountPrice,l=this.posterObj.orignPrice;var u=i.measureText(r).width;i.fillText(r,70,360*s,u),i.beginPath(),i.setFontSize(13),i.setFillStyle("#999");var d=i.measureText(l).width;i.fillText(l,70+u+5,360*s,d),i.moveTo(70+u+5,355*s),i.lineTo(70+u+5+d,355*s),i.setStrokeStyle("#999"),i.stroke(),i.closePath()}var p=this.posterObj.id;e.request({url:"https://dh.xmvogue.com/index.php/API/Index/sharecode",header:{"content-type":"application/x-www-form-urlencoded"},data:{path:c,id:p},method:"POST",success:function(t){var n="https"+t.data.slice(4,t.data.length)+"?x-oss-process=style/300";console.log(n),e.getImageInfo({src:n,success:function(e){console.log(e),o.posterObj.code=e.path,i.drawImage(o.posterObj.code,(o.phoneW-80)/2,390*s,80,80),i.draw(!0)},fail:function(e){console.log(e)}})},fail:function(e){console.log(e)}}),i.setFontSize(14),i.setFillStyle("#2f1709"),i.font="normal bold 14px sans-serif",i.setFontSize(14),i.setFillStyle("#ff5f33"),i.font="normal 14px sans-serif",i.fillText("长按/扫描识别查看商品",(o.phoneW-140)/2,490*s,140),i.save(),this.roundRect(i,(this.phoneW-160)/2,this.phoneH-140,160,36,18,"#ff3600","#ff6a00","btn"),i.restore(),i.setFontSize(14),i.setFillStyle("#fff"),i.font="normal bold 14px sans-serif",i.fillText("保存图片",(o.phoneW-58)/2,this.phoneH-118,58),e.hideLoading()},saveCanvasImage:function(){e.showLoading({title:"保存中..."});var t=this;e.canvasToTempFilePath({x:50,y:40,width:this.phoneW-100,height:this.phoneH-120,destWidth:5*(this.phoneW-100),destHeight:5*(this.phoneH-120),canvasId:"myCanvas",success:function(o){e.saveImageToPhotosAlbum({filePath:o.tempFilePath,success:function(o){e.showToast({title:"图片保存成功!",duration:2e3}),e.hideLoading(),t.canvasCancelEvn()},fail:function(t){console.log(t),e.showToast({title:"保存失败，稍后再试",duration:2e3,icon:"none"})}})},fail:function(t){e.showToast({title:"保存失败，稍后再试111",duration:2e3,icon:"none"}),console.log(t),e.hideLoading()}})},canvasCancelEvn:function(){this.$emit("cancel",!0)}}};t.default=o}).call(this,o("543d")["default"])},"1ed4":function(e,t,o){},"34aa":function(e,t,o){"use strict";var n,s=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"b",function(){return s}),o.d(t,"c",function(){return i}),o.d(t,"a",function(){return n})},9911:function(e,t,o){"use strict";o.r(t);var n=o("34aa"),s=o("0d80");for(var i in s)"default"!==i&&function(e){o.d(t,e,function(){return s[e]})}(i);o("e31c");var a,l=o("f0c5"),r=Object(l["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);t["default"]=r.exports},e31c:function(e,t,o){"use strict";var n=o("1ed4"),s=o.n(n);s.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'wxcomponents/hch-poster/hch-poster-create-component',
    {
        'wxcomponents/hch-poster/hch-poster-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("9911"))
        })
    },
    [['wxcomponents/hch-poster/hch-poster-create-component']]
]);
